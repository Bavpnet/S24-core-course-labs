# Lab 11: Kubernetes Secrets and Hashicorp Vault

## Task 1: Kubernetes Secrets and Resource Management

1. To create a secret I use the following command

```bash
kubectl create secret generic db-user-pass \
    --from-literal=username=admin \
    --from-literal=password='qwerty'
```

2. Next, I get kubectl secrets

```bash
NAME                                       TYPE                 DATA   AGE
db-user-pass                               Opaque               2      45s
sh.helm.release.v1.app-python-library.v1   helm.sh/release.v1   1      9d11h
sh.helm.release.v1.app-python.v1           helm.sh/release.v1   1      9d12h
```

3. Also, to check it I decoded secret username

```bash
kubectl get secret db-user-pass -o jsonpath='{.data}'
```
```bash
{"password":"q6l8o5b2gTx3p8r2dS==","username":"k0sZrB9="}
```
--> `echo -n "k0sZrB9=" | base64 --decode` --> admin :)

4. Check helm `kubectl get po`

```bash
NAME                                 READY   STATUS             RESTARTS      AGE
app-python-548979fcb7-2972z          0/1     ImagePullBackOff   0             36s
app-python-depl-548979fcb7-2972z     1/1     Running            4 (15m ago)   16d
app-python-depl-548979fcb7-7gzsx     1/1     Running            4 (15m ago)   16d
app-python-depl-548979fcb7-9pmdt     1/1     Running            4 (15m ago)   16d
```
5. Get password
```bash
kubectl exec app-python-depl-548979fcb7-2972z -- printenv | grep PASSWORD
PASSWORD=qwerty
```
## Task 2: Vault Secret Management System

1. Enter to the container
```bash
kubectl exec -it app-python-548979fcb7-2972z  -- /bin/sh
```
2. Output of `df -h`
```bash
Defaulted container "app-python" out of: app-python, vault-agent, vault-agent-init (init)
Filesystem                Size      Used Available Use% Mounted on
overlay                  34.3G     20.5G     10.2G  60% /
tmpfs                    64.0M         0     64.0M   0% /dev
/dev/loop3               34.3G     20.5G     10.2G  60% /dev/termination-log
/dev/loop3               34.3G     20.5G     10.2G  60% /etc/resolv.conf
/dev/loop3               34.3G     20.5G     10.2G  60% /etc/hostname
/dev/loop3               34.3G     20.5G     10.2G  60% /etc/hosts
tmpfs                    12.7G      4.9K     11.7G   0% /vault/secrets
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                     7.2G       12K      7.7G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                     3.9G         0      3.9G   0% /proc/acpi
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                     3.6G         0      3.6G   0% /proc/scsi
tmpfs                     3.6G         0      3.6G   0% /sys/firmware
```